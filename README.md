# 中国石油大学（北京）第二课堂信息抓取工具 (CUPSecond ClassInfoGrabber)

一个基于 Python `tkinter` 和 `Selenium` 的桌面应用，用于自动登录中国石油大学（北京）第二课堂系统（`https://sct.cup.edu.cn`），抓取用户已报名的活动列表，并获取活动的详细信息，如时长、标签，以及最重要的**签到/签退状态**。

### 💻 功能特性

  * **GUI 界面**：使用 `tkinter` 构建的友好桌面应用程序。
  * **Selenium 登录**：通过 WebDriver 驱动 Chrome 浏览器，等待用户手动完成登录过程。
  * **活动列表抓取**：自动解析用户中心页面，提取所有已报名的活动信息。
  * **详情数据获取**：针对最新的 N 条活动（默认为 20 条），自动访问详情页，提取活动的完整信息。
  * **详细信息提取**：
      * 活动时长和时间范围。
      * 活动标签和类别。
      * 签到和签退的组合状态。
  * **结果可视化**：使用 `Treeview` 表格展示结果，并根据活动状态（例如，已完成、未完成、待获取）**自动着色**。
  * **链接快速访问**：支持双击表格行，使用默认浏览器打开对应的活动详情页。

### 🚀 运行环境与依赖

本项目需要 Python 环境，并依赖以下库：

  * `tkinter` (Python 内置)
  * `BeautifulSoup`
  * `selenium`
  * `Chrome` 浏览器
  * 对应版本的 `ChromeDriver`

#### 安装依赖

```bash
pip install beautifulsoup4 selenium
```

#### 配置 ChromeDriver

请确保您的系统中已安装 **Chrome 浏览器**，并下载对应版本的 **ChromeDriver** 可执行文件，将其放置在系统环境变量 `$PATH` 中，或者与 `CUPSecondClassInfoGrabber.pyw` 放在同一目录下。

### ⚙️ 使用说明

1.  **启动程序**：双击运行 `CUPSecondClassInfoGrabber.pyw` 文件。
2.  **设置数量**：在输入框中设置希望获取详细信息的活动数量（默认为 20），最新的活动列表通常会优先获取。
3.  **启动抓取**：点击 **"获取活动信息"** 按钮。
4.  **完成登录**：程序将弹出 Chrome 浏览器窗口并访问登录页。**请您在弹出的浏览器窗口中手动完成登录操作**。
5.  **等待处理**：登录成功后，程序会自动检测到登录成功、获取 Cookie 和页面源码，然后最小化浏览器窗口，开始解析和抓取活动详情。
6.  **查看结果**：结果将实时显示在表格中。
      * **浅绿色背景**：签到签退均已完成 (`已签到` 和 `已签退`)。
      * **浅红色背景**：存在“未签到”或“未签退”情况。
      * **浅灰色背景**：详情尚未获取（`等待获取...`）或请求失败。
7.  **打开链接**：双击表格中的任意行，即可在默认浏览器中打开该活动的详情页面。

### 📂 代码结构概述

| 文件/函数 | 描述 |
| :--- | :--- |
| `URL_LOGIN`, `BASE_URL` | 目标网站的登录和基础 URL。 |
| `get_cookie_and_activities` | 主控制函数，负责 Selenium 驱动、登录等待、获取 Cookie、解析首页、以及控制详情页的抓取。 |
| `extract_activity_data` | 使用 `BeautifulSoup` 解析首页 HTML，提取活动名称、链接、类型等基本信息，并确定活动类型（如“第二课堂活动”或“学生组织”）。 |
| `fetch_detail_data` | 使用 `Selenium` 访问详情页，获取页面全文。 |
| `extract_data_from_text` | 使用正则表达式从详情页文本中提取时长、标签、签到/签退状态等关键信息。 |
| `sort_activities` | 辅助函数，按活动时间倒序排序（最新的在前）。 |
| `display_results` | 更新 `tkinter` 的 `Treeview` 表格和状态栏。 |
| `start_process_thread` | 在单独的线程中运行抓取逻辑，以避免 GUI 界面卡死。 |

***免责声明：本工具仅供学习和个人研究使用，请遵守学校相关规定，切勿用于恶意或违规用途。***
